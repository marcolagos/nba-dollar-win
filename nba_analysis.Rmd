---
title: "NBA Analysis"
author: "Marco Lagos"
date: "2023-04-06"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(tidyr)
library(stringr)
```

Read in the data sets (advanced_stats.csv, nba_salaries.csv, nba_team_wins.csv, 
shooting_opponent.csv, shooting_team.csv, total_opponent.csv, total_team.csv)
```{r}
nba_salaries <- read.csv("./data/nba_salaries.csv")
nba_team_wins <- read.csv("./data/nba_team_wins.csv")

advanced_stats <- read.csv("./data/advanced_stats.csv")

shooting_stats <- read.csv("./data/shooting_team.csv")
opponent_shooting_stats <- read.csv("./data/shooting_opponent.csv")

total_stats <- read.csv("./data/total_team.csv")
opponent_total_stats <- read.csv("./data/total_opponent.csv")

gdp_deflator <- read.csv("./data/gdp_deflator_by_year.csv")

# View(nba_salaries)
# View(nba_team_wins)
# View(advanced_stats)
# View(shooting_stats)
# View(opponent_shooting_stats)
# View(total_stats)
# View(opponent_total_stats)
# View(gdp_deflator)
```

Linear regression plot of team wins on total team salary. There needs to be 
inflation adjustment to the previous years so that salary is consistent. Then,
we will plot the the team wins to the total adjusted team salary by year.

We can use different index to make our USD adjustments over the course of the 20
years. Let us just choose our base year to be 2020.
1. Consumer Price Index (CPI)
	- Base Year CPI * (Current Year value / Current Year CPI)
	- This will give the adjusted amount of USD for that current year according
	  to the CPI index
2. Gross Domestic Product Deflator (GDP Deflator)
	- Base Year GDP * (Current Year value / Current Year GDP)
	- This will give the adjusted amount of USD for that current year according
	  to the CPI index
Why did we choose 2020 as the base year? Our intentions are to adjust the USD as
close as we can for the current year, so that viewers can better understand our 
analysis.

```{r}
adjust_salary_gdp_deflator <- function(base_year, nba_salaries, gdp_deflator) {
  base_year_gdp_value <- filter(gdp_deflator, year == base_year)$value

  adjusted_salary <- c()
  for (i in 1:nrow(nba_salaries)) {
  	current_year <- nba_salaries[i, 6]
	current_year_gdp_value <- filter(gdp_deflator, year == current_year)$value
	factor <- base_year_gdp_value / current_year_gdp_value
	adjusted_salary[i] <- nba_salaries[i, 5] * factor
  }
  nba_salaries <- cbind(nba_salaries, adjusted_salary)
  
  return(nba_salaries)
}

base_year <- 2020
adjusted_nba_salaries <- adjust_salary_gdp_deflator(base_year, nba_salaries, gdp_deflator)

total_salary <- adjusted_nba_salaries %>% group_by(year, team) %>% summarize(total_salary = sum(adjusted_salary))

create_total_salary_to_wins <- function(total_salary, wins) {
	wins_long <- nba_team_wins %>% pivot_longer(cols = names(nba_team_wins)[-1], names_to="team", values_to = "wins") %>% mutate(team = str_replace_all(team, "\\.", " "))
	
	total_salary$team <- str_to_lower(str_trim(total_salary$team))
	wins_long$team <- str_to_lower(str_trim(wins_long$team))
	
	merged_data <- left_join(total_salary, wins_long, by = c("year", "team"))
	names(merged_data) <- c("year", "team", "total_salary", "wins")
	return(merged_data)
}
total_salary_to_wins <- create_total_salary_to_wins(total_salary, nba_team_wins)
total_salary_to_wins <- na.omit(total_salary_to_wins)
```

Making the plot of team wins over total salary paid to players for that year. The
salaries have been adjusted and any NULL wins have been removed.
```{r}
x <- total_salary_to_wins$total_salary
y <- total_salary_to_wins$wins

model <- lm(y ~ x)
summary(model)
plot(x, y)
```

